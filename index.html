<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGI Billing - Cloud POS</title>
    <style>
        /* ඔබේ පැරණි CSS මෝස්තර මෙතැනට ඇතුළත් කළ හැකියි */
        body { font-family: 'Segoe UI', Arial, sans-serif; display: flex; height: 100vh; margin: 0; background: #f0f2f5; }
        .left { width: 65%; padding: 20px; overflow-y: auto; border-right: 2px solid #ddd; }
        .right { width: 35%; padding: 20px; background: white; display: flex; flex-direction: column; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .card { background: white; padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card img { width: 100%; height: 80px; object-fit: cover; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
    </style>
</head>
<body>

<div class="left">
    <div id="grid" class="grid"></div>
</div>

<div class="right">
    <h2>CGI එළවළු කඩේ</h2>
    <table id="billTable">
        <thead><tr><th>භාණ්ඩය</th><th>මිල</th><th>ප්‍රමාණය</th></tr></thead>
        <tbody></tbody>
    </table>
    <h3 id="total">එකතුව: Rs. 0.00</h3>
    <button onclick="window.print()" style="background:#27ae60; color:white; padding:15px; border:none; border-radius:5px; cursor:pointer;">ප්‍රින්ට් (Print)</button>
</div>

<script>
    // ඔබේ Firebase URL එක
    const DB_URL = "https://cgi-pos-default-rtdb.firebaseio.com/inventory.json";
    let inventory = [];

    // Cloud එකෙන් දත්ත ලබා ගැනීම
    async function fetchInventory() {
        try {
            const res = await fetch(DB_URL);
            const data = await res.json();
            inventory = data ? Object.values(data) : [];
            render();
        } catch (e) {
            console.error("දත්ත ලබා ගැනීමට නොහැක: ", e);
        }
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = inventory.map(p => `
            <div class="card" onclick="addToBill(${p.id})">
                <img src="images/${p.img}" onerror="this.src='https://via.placeholder.com/130x80?text=${p.name}'">
                <h4>${p.name}</h4>
                <p>Rs. ${p.sell}</p>
            </div>
        `).join('');
    }

    function addToBill(id) {
        const item = inventory.find(p => p.id === id);
        const tbody = document.querySelector('#billTable tbody');
        const row = `<tr><td>${item.name}</td><td>${item.sell}</td><td>1</td></tr>`;
        tbody.innerHTML += row;
        updateTotal(item.sell);
    }

    let totalAmount = 0;
    function updateTotal(price) {
        totalAmount += parseFloat(price);
        document.getElementById('total').innerText = `එකතුව: Rs. ${totalAmount.toFixed(2)}`;
    }

    // පිටුව විවෘත වන විට දත්ත පූරණය කිරීම
    fetchInventory();
</script>

</body>
</html>